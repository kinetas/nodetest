<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>커뮤니티 댓글</title>
</head>
<body>
  <h2>커뮤니티 상세 보기</h2>
  <div id="postDetail">로딩 중...</div>

  <h3>댓글 작성</h3>
  <textarea id="commentInput" rows="3" cols="60" placeholder="댓글을 입력하세요"></textarea>
  <button onclick="submitComment()">입력</button>

  <h3>댓글 목록</h3>
  <ul id="commentList">로딩 중...</ul>

  <script>
      const token = localStorage.getItem('jwt_token');
      const urlParams = new URLSearchParams(window.location.search);
      const cr_num = urlParams.get('cr_num');

      if (!cr_num) {
        alert('cr_num이 제공되지 않았습니다.');
        location.href = '/community_missions.html';
      }

      console.log("cr_num(community_commonets_html): ", cr_num);

      // 커뮤니티 글 상세 불러오기
      function loadCommunities() {
          fetch('/api/comumunity_missions/getOneCommunity', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify({ cr_num })  // ✅ cr_num을 POST로 보냄
          })  
          .then(response => response.json())
          .then(data => {
              console.log('getOneCommunity 응답:', data);
              const list = document.getElementById('postDetail');
              list.innerHTML = '';

              const c = data.communities; // getOneCommunity는 단일 객체 반환
              if (!c) {
                list.innerHTML = '<p>게시글을 불러올 수 없습니다.</p>';
                return;
              }

              const imgTag = c.image ? `<img src="data:image/png;base64,${c.image}" width="100">` : '';
              list.innerHTML = `
                제목: ${c.cr_title}, 내용: ${c.contents}, 조회수: ${c.hits}, 추천수: ${c.recommended_num}, 생성시간: ${new Date(c.maded_time).toLocaleString()}
                <br>${imgTag}<br>
              `;
          })
          .catch(error => console.error('커뮤니티 글 불러오기 오류:', error));
      }

    // // 댓글 목록 불러오기
    // function loadComments() {
    //   fetch(`/api/community_comments/${cr_num}`)
    //     .then(res => res.json())
    //     .then(data => {
    //       const list = document.getElementById('commentList');
    //       list.innerHTML = '';
    //       data.comments.forEach(c => {
    //         const li = document.createElement('li');
    //         li.innerText = `${c.user_nickname} (${new Date(c.created_time).toLocaleString()}): ${c.comment}`;
    //         list.appendChild(li);
    //       });
    //     })
    //     .catch(err => console.error('댓글 로딩 오류:', err));
    // }

    // loadComments();

    // // 댓글 작성
    // function submitComment() {
    //   const comment = document.getElementById('commentInput').value;
    //   if (!comment.trim()) return alert('댓글을 입력하세요.');

    //   fetch('/api/community_comments/create', {
    //     method: 'POST',
    //     headers: {
    //       'Content-Type': 'application/json',
    //       'Authorization': `Bearer ${token}`
    //     },
    //     body: JSON.stringify({ cr_num, comment })
    //   })
    //   .then(res => res.json())
    //   .then(data => {
    //     alert(data.message);
    //     document.getElementById('commentInput').value = '';
    //     loadComments();
    //   })
    //   .catch(err => console.error('댓글 작성 오류:', err));
    // }
  </script>
</body>
</html>