<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¯¸ì…˜ ëª©ë¡</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        h1 {
            color: #333;
        }
        ul {
            list-style-type: none;
            padding: 0;
        }
        li {
            margin: 15px 0;
        }
        .mission-item {
            display: flex;
            flex-wrap: wrap; /* ë²„íŠ¼ì´ ë„ˆë¬´ ê¸¸ë©´ ì¤„ë°”ê¿ˆ */
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        button {
            padding: 5px 10px;
            font-size: 14px;
            cursor: pointer;
        }
        input[type="file"] {
            padding: 5px;
            font-size: 14px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>ë¯¸ì…˜ ëª©ë¡</h1>

    <!-- ìì‹ ì—ê²Œ ìƒì„±í•œ ì§„í–‰ì¤‘ ìƒíƒœì˜ ë¯¸ì…˜ (íˆ¬í‘œ ìš”ì²­ ê°€ëŠ¥) -->
    <h2>ìì‹ ì—ê²Œ ìƒì„±í•œ ì§„í–‰ì¤‘ ìƒíƒœì˜ ë¯¸ì…˜</h2>
    <ul id="selfRequestedMissions">ë¡œë”© ì¤‘...</ul>

    <h2>ìˆ˜í–‰í•´ì•¼ í•  ë¯¸ì…˜</h2>
    <ul id="assignedMissions">ë¡œë”© ì¤‘...</ul>

    <h2>ë¶€ì—¬í•œ ë¯¸ì…˜</h2>
    <ul id="createdMissions">ë¡œë”© ì¤‘...</ul>

    <h2>ì™„ë£Œí•œ ë¯¸ì…˜</h2>
    <ul id="completedMissions">ë¡œë”© ì¤‘...</ul>

    <h2>ìƒëŒ€ê°€ ì™„ë£Œí•œ ë¯¸ì…˜</h2>
    <ul id="givenCompletedMissions">ë¡œë”© ì¤‘...</ul>

    <h2>ì¹œêµ¬ê°€ ìˆ˜í–‰í•´ì•¼ í•˜ëŠ” ë¯¸ì…˜</h2>
    <ul id="friendAssignedMissions">ë¡œë”© ì¤‘...</ul>

    <h2>ì¹œêµ¬ê°€ ì™„ë£Œí•œ ë¯¸ì…˜</h2>
    <ul id="friendCompletedMissions">ë¡œë”© ì¤‘...</ul>

    <!-- ======= ì¸ì¦ ê¶Œí•œ ë¶€ì—¬ ë¯¸ì…˜ ì¶”ê°€ ======= -->
    <h2>ì¸ì¦ ê¶Œí•œ ë¶€ì—¬ ë¯¸ì…˜</h2>
    <ul id="grantedAuthorityMissions">ë¡œë”© ì¤‘...</ul>

    <h2>ğŸ“Š ë¯¸ì…˜ í†µê³„</h2>
    <ul>
        <li id="createMissionCount">ìƒì„±í•œ ë¯¸ì…˜ ìˆ˜: ë¡œë”© ì¤‘...</li>
        <li id="assignedMissionCount">ìˆ˜í–‰ ì¤‘ì¸ ë¯¸ì…˜ ìˆ˜: ë¡œë”© ì¤‘...</li>
    </ul>

    <!-- ë¯¸ì…˜ ì‘ì—… UI -->
    <h2>ë¯¸ì…˜ ì‘ì—…</h2>
    <div class="form-container">
        <input type="text" id="m_id" placeholder="ë¯¸ì…˜ ID ì…ë ¥">
        <button onclick="deleteMission()">ë¯¸ì…˜ ì‚­ì œ</button>
        <button onclick="successMission()">ë¯¸ì…˜ ì„±ê³µ</button>
        <button onclick="failureMission()">ë¯¸ì…˜ ì‹¤íŒ¨</button>
        <button onclick="requestMissionApproval()">ë¯¸ì…˜ ìš”ì²­</button>
    </div>

    <button onclick="window.location.href='/dashboard'">ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°</button>

    <script>
        // // íˆ¬í‘œ ìš”ì²­ í•¨ìˆ˜ - missionController
        // function requestVote(m_id) {
        //     const formData = new FormData();
        //     const fileInput = document.querySelector(`#file-${m_id}`); // íŠ¹ì • ë¯¸ì…˜ì˜ íŒŒì¼ ì„ íƒê¸°
        //     formData.append('m_id', m_id);

        //     // ì„ íƒí•œ íŒŒì¼ ì¶”ê°€
        //     if (fileInput && fileInput.files[0]) {
        //         formData.append('c_image', fileInput.files[0]);
        //     }

        //     fetch('/dashboard/missionVote', {
        //         method: 'POST',
        //         body: formData,
        //     })
        //     .then(response => response.json())
        //     .then(data => {
        //         if (data.success) {
        //             alert('íˆ¬í‘œ ìš”ì²­ì´ ì„±ê³µì ìœ¼ë¡œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
        //             location.reload();
        //         } else {
        //             alert(data.message);
        //         }
        //     })
        //     .catch(error => console.error('íˆ¬í‘œ ìš”ì²­ ì¤‘ ì˜¤ë¥˜:', error));
        // }

        // // ìì‹ ì—ê²Œ ìƒì„±í•œ ì§„í–‰ì¤‘ ìƒíƒœì˜ ë¯¸ì…˜ ê°€ì ¸ì˜¤ê¸° - missionController
        // fetch('/dashboard/missions/selfRequested')
        //     .then(response => response.json())
        //     .then(data => {
        //         const list = document.getElementById('selfRequestedMissions');
        //         list.innerHTML = '';
        //         if (data.missions.length > 0) {
        //             data.missions.forEach(mission => {
        //                 const item = document.createElement('li');
        //                 item.className = "mission-item"; // ìŠ¤íƒ€ì¼ ì ìš©
        //                 item.innerHTML = `
        //                     <span>ë¯¸ì…˜ ì´ë¦„: ${mission.m_title}, ë§ˆê°ì¼: ${mission.m_deadline}</span>
        //                     <input type="file" id="file-${mission.m_id}" accept="image/*">
        //                     <button onclick="requestVote('${mission.m_id}')">íˆ¬í‘œ ìš”ì²­</button>
        //                 `;
        //                 list.appendChild(item);
        //             });
        //         } else {
        //             list.textContent = 'ìš”ì²­ ìƒíƒœì˜ ë¯¸ì…˜ì´ ì—†ìŠµë‹ˆë‹¤.';
        //         }
        //     })
        //     .catch(error => console.error('ë¯¸ì…˜ ê°€ì ¸ì˜¤ê¸° ì¤‘ ì˜¤ë¥˜:', error));

        // // ë¯¸ì…˜ ì‚­ì œ - missionController
        // function deleteMission() {
        //     const m_id = document.getElementById('m_id').value;
        //     if (!m_id) {
        //         alert("ë¯¸ì…˜ IDë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
        //         return;
        //     }
        //     fetch('/dashboard/missiondelete', {
        //         method: 'DELETE',
        //         headers: { 'Content-Type': 'application/json' },
        //         body: JSON.stringify({ m_id })
        //     })
        //     .then(response => response.json())
        //     .then(data => {
        //         alert(data.message);
        //         location.reload();
        //     })
        //     .catch(error => {
        //         console.error('Error:', error);
        //         alert('ë¯¸ì…˜ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        //     });
        // }

        // // ë¯¸ì…˜ ì„±ê³µ - missionController
        // function successMission() {
        //     const m_id = document.getElementById('m_id').value;
        //     if (!m_id) {
        //         alert("ë¯¸ì…˜ IDë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
        //         return;
        //     }
        //     fetch('/dashboard/successMission', {
        //         method: 'POST',
        //         headers: { 'Content-Type': 'application/json' },
        //         body: JSON.stringify({ m_id })
        //     })
        //     .then(response => response.json())
        //     .then(data => {
        //         alert(data.message);
        //         location.reload();
        //     })
        //     .catch(error => {
        //         console.error('Error:', error);
        //         alert(`ë¯¸ì…˜ ì„±ê³µ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜(${error})ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤ html.`);
        //     });
        // }

        // // ë¯¸ì…˜ ì‹¤íŒ¨ - missionController
        // function failureMission() {
        //     const m_id = document.getElementById('m_id').value;
        //     if (!m_id) {
        //         alert("ë¯¸ì…˜ IDë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
        //         return;
        //     }
        //     fetch('/dashboard/failureMission', {
        //         method: 'POST',
        //         headers: { 'Content-Type': 'application/json' },
        //         body: JSON.stringify({ m_id })
        //     })
        //     .then(response => response.json())
        //     .then(data => {
        //         alert(data.message);
        //         location.reload();
        //     })
        //     .catch(error => {
        //         console.error('Error:', error);
        //         alert('ë¯¸ì…˜ ì‹¤íŒ¨ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        //     });
        // }


        // // ë¯¸ì…˜ ìš”ì²­ í•¨ìˆ˜ - missionController
        // function requestMissionApproval() {
        //     // const m_id = document.getElementById('missionIdInput').value;
        //     const m_id = document.getElementById('m_id').value;

        //     if (!m_id) {
        //         alert("ë¯¸ì…˜ IDë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
        //         return;
        //     }

        //     fetch('/dashboard/missionRequest', {
        //         method: 'POST',
        //         headers: { 'Content-Type': 'application/json' },
        //         body: JSON.stringify({ m_id })
        //     })
        //     .then(response => response.json())
        //     .then(data => {
        //         if (data.success) {
        //             alert(data.message);
        //         } else {
        //             alert(data.message);
        //         }
        //     })
        //     .catch(error => {
        //         console.error('Error:', error);
        //         alert('ë¯¸ì…˜ ìš”ì²­ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        //     });
        // }

        // //===================================================================================================================
        // // ìì‹ ì´ ìˆ˜í–‰í•´ì•¼ í•  ë¯¸ì…˜ ëª©ë¡ ê°€ì ¸ì˜¤ê¸° - missionController
        // fetch('/dashboard/missions/assigned')
        //     .then(response => response.json())
        //     .then(data => {
        //         const assignedList = document.getElementById('assignedMissions');
        //         assignedList.innerHTML = ''; // ê¸°ì¡´ ë‚´ìš© ì´ˆê¸°í™”

        //         if (data.missions && data.missions.length > 0) {
        //             data.missions.forEach(mission => {
        //                 const listItem = document.createElement('li');
        //                 listItem.textContent = `
        //                     ë¯¸ì…˜ ID: ${mission.m_id},
        //                     ë°© ì´ë¦„: ${mission.r_title},
        //                     ë¯¸ì…˜ ì´ë¦„: ${mission.m_title},
        //                     ë¯¸ì…˜ ë¶€ì—¬ì: ${mission.u1_id},
        //                     ë¯¸ì…˜ ìˆ˜í–‰ì: ${mission.u2_id},
        //                     ë§ˆê°ì¼: ${mission.m_deadline},
        //                     ìƒíƒœ: ${mission.m_status},
        //                     ì¸ì¦ê¶Œí•œë¶€ì—¬ì: ${mission.missionAuthenticationAuthority}
        //                 `;
        //                 assignedList.appendChild(listItem);
        //             });
        //         } else {
        //             assignedList.textContent = 'ìˆ˜í–‰í•´ì•¼ í•  ë¯¸ì…˜ì´ ì—†ìŠµë‹ˆë‹¤.';
        //         }
        //     })
        //     .catch(error => {
        //         console.error('Error fetching assigned missions:', error);
        //         document.getElementById('assignedMissions').textContent = 'ë¯¸ì…˜ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
        //     });

        // // ìì‹ ì´ ë¶€ì—¬í•œ ë¯¸ì…˜ ëª©ë¡ ê°€ì ¸ì˜¤ê¸° - missionController
        // fetch('/dashboard/missions/created')
        //     .then(response => response.json())
        //     .then(data => {
        //         const createdList = document.getElementById('createdMissions');
        //         createdList.innerHTML = ''; // ê¸°ì¡´ ë‚´ìš© ì´ˆê¸°í™”

        //         if (data.missions && data.missions.length > 0) {
        //             data.missions.forEach(mission => {
        //                 const listItem = document.createElement('li');
        //                 listItem.textContent = `
        //                     ë¯¸ì…˜ ID: ${mission.m_id},
        //                     ë°© ì´ë¦„: ${mission.r_title},
        //                     ë¯¸ì…˜ ì´ë¦„: ${mission.m_title},
        //                     ë¯¸ì…˜ ë¶€ì—¬ì: ${mission.u1_id},
        //                     ë¯¸ì…˜ ìˆ˜í–‰ì: ${mission.u2_id},
        //                     ë§ˆê°ì¼: ${mission.m_deadline},
        //                     ìƒíƒœ: ${mission.m_status}
        //                 `;
        //                 createdList.appendChild(listItem);
        //             });
        //         } else {
        //             createdList.textContent = 'ë¶€ì—¬í•œ ë¯¸ì…˜ì´ ì—†ìŠµë‹ˆë‹¤.';
        //         }
        //     })
        //     .catch(error => {
        //         console.error('Error fetching created missions:', error);
        //         document.getElementById('createdMissions').textContent = 'ë¯¸ì…˜ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
        //     });

        // // ì™„ë£Œí•œ ë¯¸ì…˜ ëª©ë¡ ê°€ì ¸ì˜¤ê¸° - missionController
        // fetch('/dashboard/missions/completed')
        //     .then(response => response.json())
        //     .then(data => {
        //         const completedList = document.getElementById('completedMissions');
        //         completedList.innerHTML = ''; // ê¸°ì¡´ ë‚´ìš© ì´ˆê¸°í™”

        //         if (data.missions && data.missions.length > 0) {
        //             data.missions.forEach(mission => {
        //                 const listItem = document.createElement('li');
        //                 listItem.textContent = `
        //                     ë¯¸ì…˜ ID: ${mission.m_id}, 
        //                     ë¯¸ì…˜ ì´ë¦„: ${mission.m_title}, 
        //                     ë§ˆê°ì¼: ${mission.m_deadline}, 
        //                     ìƒíƒœ: ${mission.m_status} 
        //                 `;
        //                 completedList.appendChild(listItem);
        //             });
        //         } else {
        //             completedList.textContent = 'ì™„ë£Œí•œ ë¯¸ì…˜ì´ ì—†ìŠµë‹ˆë‹¤.';
        //         }
        //     });

        // // ìƒëŒ€ê°€ ì™„ë£Œí•œ ë¯¸ì…˜ ëª©ë¡ ê°€ì ¸ì˜¤ê¸° - missionController
        // fetch('/dashboard/missions/givenCompleted')
        //     .then(response => response.json())
        //     .then(data => {
        //         const givenCompletedList = document.getElementById('givenCompletedMissions');
        //         givenCompletedList.innerHTML = ''; // ê¸°ì¡´ ë‚´ìš© ì´ˆê¸°í™”

        //         if (data.missions && data.missions.length > 0) {
        //             data.missions.forEach(mission => {
        //                 const listItem = document.createElement('li');
        //                 listItem.textContent = `
        //                     ë¯¸ì…˜ ID: ${mission.m_id}, 
        //                     ë¯¸ì…˜ ì´ë¦„: ${mission.m_title}, 
        //                     ë§ˆê°ì¼: ${mission.m_deadline}, 
        //                     ìƒíƒœ: ${mission.m_status}
        //                 `;
        //                 givenCompletedList.appendChild(listItem);
        //             });
        //         } else {
        //             givenCompletedList.textContent = 'ìƒëŒ€ê°€ ì™„ë£Œí•œ ë¯¸ì…˜ì´ ì—†ìŠµë‹ˆë‹¤.';
        //         }
        //     });

        // //===================================================================================================================

        // // ====== ì¹œêµ¬ê°€ ìˆ˜í–‰í•´ì•¼ í•˜ëŠ” ë¯¸ì…˜ ê°€ì ¸ì˜¤ê¸° ====== - missionController
        // fetch('/dashboard/missions/friendAssigned')
        //     .then(response => response.json())
        //     .then(data => {
        //         const list = document.getElementById('friendAssignedMissions');
        //         list.innerHTML = '';
        //         if (data.missions.length > 0) {
        //             data.missions.forEach(mission => {
        //                 const item = document.createElement('li');
        //                 item.textContent = `
        //                     ë¯¸ì…˜ ID: ${mission.m_id}, 
        //                     ë¯¸ì…˜ ì´ë¦„: ${mission.m_title}, 
        //                     ìˆ˜í–‰ì: ${mission.u2_id}, 
        //                     ë§ˆê°ì¼: ${mission.m_deadline}
        //                 `;
        //                 list.appendChild(item);
        //             });
        //         } else {
        //             list.textContent = 'ì¹œêµ¬ê°€ ìˆ˜í–‰í•´ì•¼ í•  ë¯¸ì…˜ì´ ì—†ìŠµë‹ˆë‹¤.';
        //         }
        //     });

        // // ====== ì¹œêµ¬ê°€ ì™„ë£Œí•œ ë¯¸ì…˜ ê°€ì ¸ì˜¤ê¸° ====== - missionController
        // fetch('/dashboard/missions/friendCompleted')
        //     .then(response => response.json())
        //     .then(data => {
        //         const list = document.getElementById('friendCompletedMissions');
        //         list.innerHTML = '';
        //         if (data.missions.length > 0) {
        //             data.missions.forEach(mission => {
        //                 const item = document.createElement('li');
        //                 item.textContent = `
        //                     ë¯¸ì…˜ ID: ${mission.m_id}, 
        //                     ë¯¸ì…˜ ì´ë¦„: ${mission.m_title}, 
        //                     ìˆ˜í–‰ì: ${mission.u2_id}, 
        //                     ì™„ë£Œì¼: ${mission.m_deadline}
        //                 `;
        //                 list.appendChild(item);
        //             });
        //         } else {
        //             list.textContent = 'ì¹œêµ¬ê°€ ì™„ë£Œí•œ ë¯¸ì…˜ì´ ì—†ìŠµë‹ˆë‹¤.';
        //         }
        //     });

        // // ======= ì¸ì¦ ê¶Œí•œ ë¶€ì—¬ ë¯¸ì…˜ ëª©ë¡ ì¶”ê°€ ======= - missionController
        // fetch('/dashboard/missions/grantedAuthority')
        //     .then(response => response.json())
        //     .then(data => {
        //         const list = document.getElementById('grantedAuthorityMissions');
        //         list.innerHTML = '';
        //         if (data.missions.length > 0) {
        //             data.missions.forEach(mission => {
        //                 const item = document.createElement('li');
        //                 item.textContent = `
        //                     ë¯¸ì…˜ ID: ${mission.m_id}, 
        //                     ë¯¸ì…˜ ì´ë¦„: ${mission.m_title}, 
        //                     ì¸ì¦ ê¶Œí•œì: ${mission.missionAuthenticationAuthority}, 
        //                     ëŒ€ìƒ: ${mission.u2_id}, 
        //                     ë§ˆê°ì¼: ${mission.m_deadline}
        //                 `;
        //                 list.appendChild(item);
        //             });
        //         } else {
        //             list.textContent = 'ì¸ì¦ ê¶Œí•œ ë¶€ì—¬ ë¯¸ì…˜ì´ ì—†ìŠµë‹ˆë‹¤.';
        //         }
        //     });

        //========================================token=====================================

        // const savedKeyCloakToken = localStorage.getItem('keycloak_token');
        // const idToken = localStorage.getItem('id_token');

        // if (!savedKeyCloakToken) {
        //     alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
        //     location.href = '/';
        // }

        const jwtToken = localStorage.getItem('jwt_token');
        console.log("jwt_token: ", jwtToken)
        if (!jwtToken) {
            alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.(printmissionlist:422)");
            location.href = '/';
        }

        const authHeaderKeyCloak = {
            Authorization: `Bearer ${jwtToken}`
        };

        function requestVote(m_id) {
            const fileInput = document.getElementById(`file-${m_id}`);
            const formData = new FormData();
            formData.append('m_id', m_id);
            if (fileInput?.files[0]) {
                formData.append('c_image', fileInput.files[0]);
            }

            fetch('/dashboard/missionVote', {
                method: 'POST',
                headers: authHeaderKeyCloak,
                body: formData
            })
            .then(res => res.json())
            .then(data => {
                alert(data.message);
                if (data.success) location.reload();
            })
            .catch(err => console.error('íˆ¬í‘œ ìš”ì²­ ì˜¤ë¥˜:', err));
        }

        function deleteMission() {
            const m_id = document.getElementById('m_id').value;
            if (!m_id) return alert("ë¯¸ì…˜ IDë¥¼ ì…ë ¥í•˜ì„¸ìš”.");

            fetch('/dashboard/missiondelete', {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json',
                    ...authHeaderKeyCloak
                },
                body: JSON.stringify({ m_id })
            })
            .then(res => res.json())
            .then(data => {
                alert(data.message);
                location.reload();
            });
        }

        function successMission() {
            const m_id = document.getElementById('m_id').value;
            if (!m_id) return alert("ë¯¸ì…˜ IDë¥¼ ì…ë ¥í•˜ì„¸ìš”.");

            fetch('/dashboard/successMission', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    ...authHeaderKeyCloak
                },
                body: JSON.stringify({ m_id })
            })
            .then(res => res.json())
            .then(data => {
                alert(data.message);
                location.reload();
            });
        }

        function failureMission() {
            const m_id = document.getElementById('m_id').value;
            if (!m_id) return alert("ë¯¸ì…˜ IDë¥¼ ì…ë ¥í•˜ì„¸ìš”.");

            fetch('/dashboard/failureMission', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    ...authHeaderKeyCloak
                },
                body: JSON.stringify({ m_id })
            })
            .then(res => res.json())
            .then(data => {
                alert(data.message);
                location.reload();
            });
        }

        function requestMissionApproval() {
            const m_id = document.getElementById('m_id').value;
            if (!m_id) return alert("ë¯¸ì…˜ IDë¥¼ ì…ë ¥í•˜ì„¸ìš”.");

            fetch('/dashboard/missionRequest', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    ...authHeaderKeyCloak
                },
                body: JSON.stringify({ m_id })
            })
            .then(res => res.json())
            .then(data => alert(data.message));
        }

        const fetchMissions = (endpoint, elementId, renderFn) => {
            fetch(endpoint, { headers: authHeaderKeyCloak })
                .then(res => res.json())
                .then(data => {
                    const el = document.getElementById(elementId);
                    el.innerHTML = '';
                    if (data.missions?.length > 0) {
                        data.missions.forEach(m => {
                            el.appendChild(renderFn(m));
                        });
                    } else {
                        el.textContent = 'í•´ë‹¹ ë¯¸ì…˜ì´ ì—†ìŠµë‹ˆë‹¤.';
                    }
                })
                .catch(err => console.error(`${endpoint} ì˜¤ë¥˜:`, err));
        };

        fetchMissions('/dashboard/missions/selfRequested', 'selfRequestedMissions', m => {
            const li = document.createElement('li');
            li.className = 'mission-item';
            li.innerHTML = `
                <span>ë¯¸ì…˜ ì´ë¦„: ${m.m_title}, ë§ˆê°ì¼: ${m.m_deadline}</span>
                <input type="file" id="file-${m.m_id}" accept="image/*">
                <button onclick="requestVote('${m.m_id}')">íˆ¬í‘œ ìš”ì²­</button>
            `;
            return li;
        });

        fetchMissions('/dashboard/missions/assigned', 'assignedMissions', m => {
            const li = document.createElement('li');
            li.textContent = `ë¯¸ì…˜ ì´ë¦„: ${m.m_title}, ìˆ˜í–‰ì: ${m.u2_id}, ë§ˆê°ì¼: ${m.m_deadline}`;
            return li;
        });

        fetchMissions('/dashboard/missions/created', 'createdMissions', m => {
            const li = document.createElement('li');
            li.textContent = `ë¯¸ì…˜ ì´ë¦„: ${m.m_title}, ë¶€ì—¬ì: ${m.u1_id}, ìˆ˜í–‰ì: ${m.u2_id}, ë§ˆê°ì¼: ${m.m_deadline}`;
            return li;
        });

        fetchMissions('/dashboard/missions/completed', 'completedMissions', m => {
            const li = document.createElement('li');
            li.textContent = `ë¯¸ì…˜ ì´ë¦„: ${m.m_title}, ë§ˆê°ì¼: ${m.m_deadline}, ìƒíƒœ: ${m.m_status}`;
            return li;
        });

        fetchMissions('/dashboard/missions/givenCompleted', 'givenCompletedMissions', m => {
            const li = document.createElement('li');
            li.textContent = `ë¯¸ì…˜ ì´ë¦„: ${m.m_title}, ë§ˆê°ì¼: ${m.m_deadline}, ìƒíƒœ: ${m.m_status}`;
            return li;
        });

        fetchMissions('/dashboard/missions/friendAssigned', 'friendAssignedMissions', m => {
            const li = document.createElement('li');
            li.textContent = `ë¯¸ì…˜ ì´ë¦„: ${m.m_title}, ìˆ˜í–‰ì: ${m.u2_id}, ë§ˆê°ì¼: ${m.m_deadline}`;
            return li;
        });

        fetchMissions('/dashboard/missions/friendCompleted', 'friendCompletedMissions', m => {
            const li = document.createElement('li');
            li.textContent = `ë¯¸ì…˜ ì´ë¦„: ${m.m_title}, ìˆ˜í–‰ì: ${m.u2_id}, ì™„ë£Œì¼: ${m.m_deadline}`;
            return li;
        });

        fetchMissions('/dashboard/missions/grantedAuthority', 'grantedAuthorityMissions', m => {
            const li = document.createElement('li');
            li.textContent = `ë¯¸ì…˜ ì´ë¦„: ${m.m_title}, ê¶Œí•œì: ${m.missionAuthenticationAuthority}, ëŒ€ìƒ: ${m.u2_id}`;
            return li;
        });

        // ìƒì„±í•œ ë¯¸ì…˜ ìˆ˜ ê°€ì ¸ì˜¤ê¸°
        fetch('/dashboard/missions/createMissionCount', {
            headers: { 'Authorization': `Bearer ${jwtToken}` }
        })
        .then(res => res.json())
        .then(data => {
            document.getElementById('createMissionCount').textContent = `ìƒì„±í•œ ë¯¸ì…˜ ìˆ˜: ${data.createMissionCount}`;
        })
        .catch(err => {
            console.error('ìƒì„±í•œ ë¯¸ì…˜ ìˆ˜ ì¡°íšŒ ì‹¤íŒ¨:', err);
            document.getElementById('createMissionCount').textContent = 'ìƒì„±í•œ ë¯¸ì…˜ ìˆ˜ ì¡°íšŒ ì‹¤íŒ¨';
        });

        // ìˆ˜í–‰ ì¤‘ì¸ ë¯¸ì…˜ ìˆ˜ ê°€ì ¸ì˜¤ê¸°
        fetch('/dashboard/missions/assignedMissionCount', {
            headers: { 'Authorization': `Bearer ${jwtToken}` }
        })
        .then(res => res.json())
        .then(data => {
            document.getElementById('assignedMissionCount').textContent = `ìˆ˜í–‰ ì¤‘ì¸ ë¯¸ì…˜ ìˆ˜: ${data.assignedMissionCount}`;
        })
        .catch(err => {
            console.error('ìˆ˜í–‰ ì¤‘ì¸ ë¯¸ì…˜ ìˆ˜ ì¡°íšŒ ì‹¤íŒ¨:', err);
            document.getElementById('assignedMissionCount').textContent = 'ìˆ˜í–‰ ì¤‘ì¸ ë¯¸ì…˜ ìˆ˜ ì¡°íšŒ ì‹¤íŒ¨';
        });
    </script>
</body>
</html>