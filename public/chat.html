<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>채팅방</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.min.js"></script>
</head>
<body>
    <h1>채팅방</h1>
    <div id="chatMessages">메시지 목록</div>
    <input type="text" id="messageInput" placeholder="메시지를 입력하세요">
    <button onclick="sendMessage()">전송</button>

    

    <h2>방 미션 목록</h2>
    <ul id="roomMissionList">로딩 중...</ul>
    <div class="form-container">
        <input type="text" id="u2_id_input" placeholder="상대방 ID 입력">
        <button onclick="printRoomMission()">방 미션 출력</button> 
    </div>
    

    <script>
        // URL에서 roomId 가져오기
        const urlParams = new URLSearchParams(window.location.search);
        const roomId = urlParams.get('r_id'); // URL 파라미터에서 roomId 추출
        const socket = io("http://43.203.233.135:3001",{
            path: '/socket.io'
        });

        socket.on("connect", () => {
            console.log("서버에 연결되었습니다.");
            socket.emit("joinRoom", { roomId });
        });

        socket.on("message", (data) => {
            const chatMessages = document.getElementById("chatMessages");
            const messageElement = document.createElement("div");
            messageElement.textContent = `${data.userId}: ${data.message}`;
            chatMessages.appendChild(messageElement);
        });

        function sendMessage() {
            const message = document.getElementById("messageInput").value;
            socket.emit("sendMessage", { roomId, message });
            document.getElementById("messageInput").value = ""; // 메시지 입력란 비우기
        }

        // 방 미션 출력
        fetch('/rooms/printRoomMission')
            .then(response => response.json())
            .then(data => {
                const roomMissionListElement = document.getElementById('roomMissionList');
                roomMissionListElement.innerHTML = '';

                if (data.printRoomMission && data.printRoomMission.length > 0) {
                    data.printRoomMission.forEach(fId => {
                        const listItem = document.createElement('li');
                        listItem.textContent = `친구 아이디: ${fId}`;
                        roomMissionListElement.appendChild(listItem);
                    });
                } else {
                    roomMissionListElement.textContent = '해당 방에 미션이 없습니다.';
                }
            })
            .catch(error => {
                console.error('Error fetching i_friend list:', error);
                document.getElementById('roomMissionList').textContent = '방미션 목록을 불러오는 중 오류가 발생했습니다.';
            });
    </script>
</body>
</html>